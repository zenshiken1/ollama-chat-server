<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>Ai Chat</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f1f3f5; margin:0; padding:20px;}
    #chat  { max-width:680px; margin:auto; background:white; padding:20px; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,.1);}
    #messages { height:420px; overflow-y:auto; border:1px solid #ddd; padding:12px; margin-bottom:10px;}
    .msg { margin:8px 0; line-height:1.4;}
    .user { color:#0b5cff; font-weight:bold;}
    .bot  { color:#22863a; }
    #inputBar { display:flex; gap:8px; }
    input[type=text]{ flex:1; padding:8px; border:1px solid #ccc; border-radius:6px;}
    button{ padding:8px 16px; border:none; background:#0b5cff; color:white; border-radius:6px; cursor:pointer;}
    button:disabled{ background:#888; }
  </style>
</head>
<body>
  <div id="chat">
    <h2>ðŸ§  Chat</h2>
    <div id="messages"></div>

    <div id="inputBar">
      <input id="input" type="text" placeholder="å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚(Enterç™ºé€)â€¦"/>
      <button id="sendBtn">send</button>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket   = io();
    const input    = document.getElementById('input');
    const sendBtn  = document.getElementById('sendBtn');
    const messages = document.getElementById('messages');
    let  currentBotDiv = null;   // æ­£åœ¨æµå¼è¾“å‡ºçš„ div

    // å·¥å…·ï¼šè¿½åŠ ä¸€æ¡æ¶ˆæ¯
    function append(text, cls){
      const div = document.createElement('div');
      div.className = 'msg ' + cls;
      div.textContent = text;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
      return div;
    }

    // å‘é€
    function send(){
      const text = input.value.trim();
      if(!text) return;
      append('you: ' + text, 'user');
      socket.emit('userMessage', text);
      input.value = '';
      input.focus();
    }

    // Bot å¼€å§‹å›žå¤ï¼šå…ˆæ”¾ä¸€ä¸ªç©ºè¡Œ
    socket.on('botStart', () => {
      currentBotDiv = append('AI: ', 'bot');
    });

    // æ¯åˆ°ä¸€å°æ®µæ–‡æœ¬å°±è¿½åŠ 
    socket.on('botStream', chunk => {
      if(currentBotDiv){
        currentBotDiv.textContent += chunk;
        messages.scrollTop = messages.scrollHeight;
      }
    });

    // ç»“æŸ
    socket.on('botDone', () => {
      currentBotDiv = null;
    });

    // é”®ç›˜ Enter
    input.addEventListener('keydown', e => { if(e.key === 'Enter') send(); });
    sendBtn.addEventListener('click', send);
  </script>
</body>
</html>
